<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>HHSGC — Mobile Scorecard + Greenies (Points + Correct Dots) — v2</title>
<style>
  :root{--grid:#e5e7eb;--ink:#111827;--muted:#f3f4f6;--disabled:#f8fafc}
  .wrap{display:flex;gap:10px;flex-direction:column;padding:8px}
  .panel{border:2px solid #e5e7eb;border-radius:12px;padding:10px}
  .card{border:2px solid #e5e7eb;border-radius:12px;padding:8px}
  .row{display:flex;gap:8px;align-items:center}
  input.sc{padding:10px 4px;font-size:18px;border:0;width:100%;text-align:center;font-weight:900}
  input.pt{padding:10px 4px;font-size:16px;border:0;border-top:1px dashed #e5e7eb;width:100%;text-align:center;font-weight:900}
  th{padding:6px 4px;font-size:14px}
  td .tiny{font-size:12px}
  .name{position:sticky;left:0;background:#f3f4f6}
  .grid{overflow:auto;-webkit-overflow-scrolling:touch}
  .btn{padding:10px 12px;border-radius:12px}
  .badge{padding:6px 10px}
  .divider{min-width:54px}
  @media (orientation:landscape){
    .wrap{flex-direction:row}
    .panel{flex:0 0 360px}
  }
      
  table{border-collapse:separate;border-spacing:0;width:100%}
  th,td{border-right:1px solid var(--grid);border-bottom:1px solid var(--grid)}
  th:first-child,td:first-child{border-left:1px solid var(--grid)}
  thead th{position:sticky;top:0;background:#f8fafc;z-index:1}
  th{background:#eef2ff;text-align:center;white-space:nowrap}
  td{padding:0;text-align:center}
  .name{text-align:left;padding:6px;font-weight:900}
  .sum{background:#e8fff2;font-weight:900}
  .seg{background:#ecfeff;text-align:center;font-weight:900; user-select:none}
  .tiny{font-size:11px;color:#6b7280;font-weight:900}
  .btn{border:2px solid #111;background:#111;color:#fff;border-radius:12px}
  .btn.ghost{background:transparent;color:#111}
  .divider{background:#fff;font-weight:900}
  .asidebox{margin-top:10px;border:2px dashed var(--grid);border-radius:10px;padding:8px}
  .gdisabled{background:var(--disabled); color:#9ca3af}
  .gcell{font-size:18px;line-height:1;padding:6px 0}
  .labelcell{white-space:nowrap}
  .gmark{position:absolute; right:4px; bottom:2px; font-size:14px; line-height:1; }
  .cellwrap{position:relative; display:grid; grid-template-rows:1fr 1fr}
  select.greenie{width:100%; font-weight:800; border:0; background:transparent; padding:4px 0}
  select.greenie:disabled{opacity:.6}
</style>

<link rel="manifest" href="manifest.webmanifest">
<meta name="theme-color" content="#111111">
<script>
if('serviceWorker' in navigator){window.addEventListener('load',()=>navigator.serviceWorker.register('./sw.js'));}
</script>
      
</head>
<body>
<div class="wrap">
  <aside class="panel">
    <h2 style="margin:0 0 8px">Setup</h2>
    <label>Event</label>
    <input id="eventName" type="text" value="HHSGC — Rotating Teams (6/6/6)" style="width:100%;padding:10px;border:2px solid var(--grid);border-radius:10px;font-weight:700">
    <label>Scoring method (for hole winners)</label>
    <select id="method" style="width:100%;padding:10px;border:2px solid var(--grid);border-radius:10px;font-weight:700">
      <option value="best">Best Ball (lowest single per team)</option>
      <option value="sum" selected>Team Total (sum all players on team)</option>
    </select>

    <label>Players & Teams by Segment</label>
    <div class="tiny" style="margin-bottom:6px">S1 = Holes 1–6 · S2 = 7–12 · S3 = 13–18</div>
    <div id="players"></div>
    <div class="row" style="margin-top:8px">
      <button class="btn" id="addP">+ Add Player</button>
      <button class="btn ghost" id="clearP">Clear Scores</button>
    </div>

    <div class="asidebox tiny" id="moneySummary">$1 per player goes to lowest total putts (ties split). Segment bonuses: $0.25/player per winning segment.<br>Greenies: winner earns <b>points equal to dots</b> shown for that par-3 (1 by default; carries add dots). No deductions for others.</div>

    <div class="asidebox tiny">
      <div style="font-weight:900;margin-bottom:6px">Greenies</div>
      <div style="margin-bottom:6px">Dots: 1 on each par-3. If previous par-3 carried, next winner shows 2 dots; 3 dots if two straight carries, etc.</div>
      <label>Par-3 holes (comma-separated)</label>
      <input id="par3Input" type="text" value="3,7,12,16" style="width:100%;padding:8px;border:2px solid var(--grid);border-radius:10px;font-weight:700">
    </div>
  </aside>

  <section class="card">
    <div class="row" style="justify-content:space-between;align-items:center;flex-wrap:wrap">
      <div id="titleOut" style="font-size:20px;font-weight:900">HHSGC — Rotating Teams (6/6/6)</div>
      <span class="badge">OUT/IN · Segment points · $1 Putts Pot · Greenies</span>
    </div>
    <div class="grid">
      <table id="card">
        <thead id="thead"></thead>
        <tbody id="tbody"></tbody>
      </table>
    </div>
  </section>
</div>

<script>
(function(){
  'use strict';
  var state = {players:[
      {name:"Dave",teams:["A","B","A"]},
      {name:"Earl",teams:["B","A","B"]},
      {name:"Greg",teams:["A","B","A"]},
      {name:"Cloy",teams:["B","A","B"]}
    ],
    scores:{}, method:"sum", segmentBonus:0.25, puttFee:1.00,
    par3:[3,7,12,16],
    greenieWinner:Array(18).fill("") // winner per hole: '', 'CARRY', or player name
  };
  var pending=null;
  function ensure(n){ if(!state.scores[n]) state.scores[n]={strokes:Array(18).fill(""), putts:Array(18).fill("")}; }
  function $(id){return document.getElementById(id);}
  function seg(h){return Math.floor(h/6);}
  function dotText(n){ return n>0 ? "•".repeat(Math.min(4,n)) : ""; }

  function renderSidebar(){
    var host=$("players"); host.innerHTML="";
    state.players.forEach(function(p,i){
      ensure(p.name);
      var row=document.createElement("div"); row.className="row"; row.style.marginBottom="6px";
      row.innerHTML=''
        + '<input type="text" value="'+p.name+'" data-i="'+i+'" class="pname" style="flex:2;padding:10px;border:2px solid #e5e7eb;border-radius:10px;font-weight:700">'
        + '<select data-i="'+i+'" data-s="0" class="pteam" style="padding:10px;border:2px solid #e5e7eb;border-radius:10px"><option '+(p.teams[0]==="A"?"selected":"")+'>A</option><option '+(p.teams[0]==="B"?"selected":"")+'>B</option></select>'
        + '<select data-i="'+i+'" data-s="1" class="pteam" style="padding:10px;border:2px solid #e5e7eb;border-radius:10px"><option '+(p.teams[1]==="A"?"selected":"")+'>A</option><option '+(p.teams[1]==="B"?"selected":"")+'>B</option></select>'
        + '<select data-i="'+i+'" data-s="2" class="pteam" style="padding:10px;border:2px solid #e5e7eb;border-radius:10px"><option '+(p.teams[2]==="A"?"selected":"")+'>A</option><option '+(p.teams[2]==="B"?"selected":"")+'>B</option></select>'
        + '<button class="btn ghost" data-del="'+i+'" style="flex:0 0 auto;padding:8px 10px">✕</button>';
      host.appendChild(row);
    });
    $("par3Input").value = state.par3.join(",");
  }

  function playerOptionsHTML(){
    var opts = ['<option value=""></option>','<option value="CARRY">Carry</option>'];
    state.players.forEach(function(p){ opts.push('<option value="'+p.name+'">'+p.name+'</option>'); });
    return opts.join('');
  }

  function renderTable(){
    var thead=$("thead"), tbody=$("tbody"); thead.innerHTML=""; tbody.innerHTML="";
    var trh=document.createElement("tr");
    var th0=document.createElement("th"); th0.textContent="Player (S1/S2/S3)"; trh.appendChild(th0);
    for(var h=1;h<=18;h++){
      var th=document.createElement("th"); th.innerHTML='H'+h+'<div class="tiny">Strokes / Putts</div>'; trh.appendChild(th);
      if(h===9){ let thd=document.createElement("th"); thd.className="divider"; thd.textContent="OUT"; trh.appendChild(thd); }
      if(h===18){ let thd=document.createElement("th"); thd.className="divider"; thd.textContent="IN"; trh.appendChild(thd); }
    }
    var thp1=document.createElement("th"); thp1.textContent="Pts S1"; trh.appendChild(thp1);
    var thp2=document.createElement("th"); thp2.textContent="Pts S2"; trh.appendChild(thp2);
    var thp3=document.createElement("th"); thp3.textContent="Pts S3"; trh.appendChild(thp3);
    var thpt=document.createElement("th"); thpt.textContent="Putts TOT"; trh.appendChild(thpt);
    var tht=document.createElement("th"); tht.textContent="Strokes TOT"; trh.appendChild(tht);
    var thearn=document.createElement("th"); thearn.textContent="Earnings $"; trh.appendChild(thearn);
    var thgp=document.createElement("th"); thgp.textContent="Greenies Pts"; trh.appendChild(thgp);
    thead.appendChild(trh);

    state.players.forEach(function(p,i){
      ensure(p.name);
      var sc=state.scores[p.name];
      var tr=document.createElement("tr");
      var nameCell=document.createElement("td"); nameCell.className="name";
      nameCell.textContent = p.name+" ("+p.teams.join('/')+")"; tr.appendChild(nameCell);
      var out=0, inn=0, sum=0, puttsTot=0;
      for(var h=0;h<18;h++){
        var td=document.createElement("td");
        td.innerHTML='<div class="cellwrap">'
          + '<input class="sc" inputmode="numeric" maxlength="2" data-n="'+p.name+'" data-k="strokes" data-h="'+h+'" data-r="'+(i*2)+'" data-c="'+h+'" value="'+(sc.strokes[h])+'">'
          + '<input class="pt tiny" inputmode="numeric" maxlength="2" data-n="'+p.name+'" data-k="putts" data-h="'+h+'" data-r="'+(i*2+1)+'" data-c="'+h+'" value="'+(sc.putts[h])+'">'
          + '</div>';
        if(state.greenieWinner[h] === p.name){
          var wrap = document.createElement("div");
          wrap.className = "gmark";
          wrap.textContent = "•";
          td.firstChild.appendChild(wrap);
        }
        tr.appendChild(td);
        var v=parseFloat(sc.strokes[h]); if(!isNaN(v)){ sum+=v; if(h<9) out+=v; else inn+=v; }
        var pval=parseFloat(sc.putts[h]); if(!isNaN(pval)) puttsTot+=pval;
        if(h===8){ let c=document.createElement("td"); c.className="sum"; c.dataset.outFor=p.name; c.textContent=out||""; tr.appendChild(c); }
        if(h===17){ let c=document.createElement("td"); c.className="sum"; c.dataset.inFor=p.name; c.textContent=inn||""; tr.appendChild(c); }
      }
      let ps1=document.createElement("td"); ps1.className="sum"; ps1.dataset.psegFor=p.name; ps1.dataset.seg="0"; ps1.textContent="0"; tr.appendChild(ps1);
      let ps2=document.createElement("td"); ps2.className="sum"; ps2.dataset.psegFor=p.name; ps2.dataset.seg="1"; ps2.textContent="0"; tr.appendChild(ps2);
      let ps3=document.createElement("td"); ps3.className="sum"; ps3.dataset.psegFor=p.name; ps3.dataset.seg="2"; ps3.textContent="0"; tr.appendChild(ps3);
      var ptt=document.createElement("td"); ptt.className="sum"; ptt.dataset.puttsFor=p.name; ptt.textContent=puttsTot||""; tr.appendChild(ptt);
      var tot=document.createElement("td"); tot.className="sum"; tot.dataset.totFor=p.name; tot.textContent=sum||""; tr.appendChild(tot);
      var earn=document.createElement("td"); earn.className="sum"; earn.dataset.earnFor=p.name; earn.textContent="0.00"; tr.appendChild(earn);
      var gp=document.createElement("td"); gp.className="sum"; gp.dataset.gpFor=p.name; gp.textContent="0"; tr.appendChild(gp);
      $("tbody").appendChild(tr);
    });

    var winRow=document.createElement("tr");
    var winLab=document.createElement("td"); winLab.className="seg labelcell"; winLab.textContent="Hole Winner (segment teams)"; winRow.appendChild(winLab);
    for(var h=0;h<18;h++){
      var td=document.createElement("td"); td.className="seg"; td.id="win_"+h; td.textContent="-"; winRow.appendChild(td);
      if(h===8){ let d=document.createElement("td"); d.className="seg"; d.textContent=""; winRow.appendChild(d); }
      if(h===17){ let d=document.createElement("td"); d.className="seg"; d.textContent=""; winRow.appendChild(d); }
    }
    var tail=document.createElement("td"); tail.className="seg"; tail.colSpan=7; tail.textContent=""; winRow.appendChild(tail);
    $("tbody").appendChild(winRow);

    // Greenies Dot Row (auto)
    var gRow=document.createElement("tr");
    var gLab=document.createElement("td"); gLab.className="seg labelcell"; gLab.textContent="Greenies (dots)"; gRow.appendChild(gLab);
    for(var gh=1; gh<=18; gh++){
      var td=document.createElement("td");
      var isP3=state.par3.indexOf(gh)>=0;
      td.className="seg gcell"+(isP3?"":" gdisabled");
      td.dataset.h1 = gh;
      td.id = "green_"+(gh-1);
      td.textContent = isP3 ? "•" : "—"; // default 1 dot
      gRow.appendChild(td);
      if(gh===9){ let d=document.createElement("td"); d.className="seg"; d.textContent=""; gRow.appendChild(d); }
      if(gh===18){ let d=document.createElement("td"); d.className="seg"; d.textContent=""; gRow.appendChild(d); }
    }
    var gtail=document.createElement("td"); gtail.className="seg"; gtail.colSpan=7; gtail.textContent=""; gRow.appendChild(gtail);
    $("tbody").appendChild(gRow);

    // Greenie Winner Selection Row
    var selRow=document.createElement("tr");
    var sLab=document.createElement("td"); sLab.className="seg labelcell"; sLab.textContent="Greenie Winner (select)"; selRow.appendChild(sLab);
    for(var sh=1; sh<=18; sh++){
      var td=document.createElement("td"); td.className="seg";
      var isP3=state.par3.indexOf(sh)>=0;
      if(isP3){
        var sel=document.createElement("select");
        sel.className="greenie";
        sel.dataset.h1 = sh;
        sel.innerHTML = playerOptionsHTML();
        sel.value = state.greenieWinner[sh-1] || "";
        td.appendChild(sel);
      } else {
        td.classList.add("gdisabled");
        td.textContent = "—";
      }
      selRow.appendChild(td);
      if(sh===9){ let d=document.createElement("td"); d.className="seg"; d.textContent=""; selRow.appendChild(d); }
      if(sh===18){ let d=document.createElement("td"); d.className="seg"; d.textContent=""; selRow.appendChild(d); }
    }
    var stail=document.createElement("td"); stail.className="seg"; stail.colSpan=7; stail.textContent=""; selRow.appendChild(stail);
    $("tbody").appendChild(selRow);
  }

  function holeComplete(c){ for(var i=0;i<state.players.length;i++){var nm=state.players[i].name,s=state.scores[nm]; if((s.strokes[c]+'').trim()===''||(s.putts[c]+'').trim()==='') return false;} return true; }
  function firstMissing(c){ for(var i=0;i<state.players.length;i++){var nm=state.players[i].name,s=state.scores[nm]; if((s.strokes[c]+'').trim()==='') return document.querySelector('input.sc[data-n="'+nm+'"][data-c="'+c+'"]'); if((s.putts[c]+'').trim()==='') return document.querySelector('input.pt[data-n="'+nm+'"][data-c="'+c+'"]');} return null; }
  function moveDown(r,c){ var next=document.querySelector('input[data-r="'+(r+1)+'"][data-c="'+c+'"]'); if(next){next.focus();next.select();return;} if(holeComplete(c)){ var adv=document.querySelector('input[data-r="0"][data-c="'+(c+1)+'"]'); if(adv){adv.focus();adv.select();return;} } else { var miss=firstMissing(c); if(miss){miss.focus();miss.select();} }}
  function moveUp(r,c){ var prev=document.querySelector('input[data-r="'+(r-1)+'"][data-c="'+c+'"]'); if(prev){prev.focus();prev.select();return;} var lastR=state.players.length*2-1; var back=document.querySelector('input[data-r="'+lastR+'"][data-c="'+(c-1)+'"]'); if(back){back.focus();back.select();} }

  function recompute(){
    // Segment winners per hole (Sixes)
    var segmentTeamWins=[{A:0,B:0},{A:0,B:0},{A:0,B:0}];
    for(var h=0;h<18;h++){
      var sg=seg(h),a=[],b=[];
      state.players.forEach(function(p){var t=p.teams[sg]; var v=parseFloat(state.scores[p.name]?.strokes[h]); if(isNaN(v)) return; if(t==="A") a.push(v); else if(t==="B") b.push(v);});
      var as=null,bs=null;
      if(state.method==="best"){ if(a.length) as=Math.min.apply(null,a); if(b.length) bs=Math.min.apply(null,b); }
      else { if(a.length) as=a.reduce(function(x,c){return x+c;},0); if(b.length) bs=b.reduce(function(x,c){return x+c;},0); }
      var w=document.getElementById("win_"+h);
      if(as!=null && bs!=null){
        if(as<bs){ if(w) w.textContent="A"; segmentTeamWins[sg].A++; }
        else if(bs<as){ if(w) w.textContent="B"; segmentTeamWins[sg].B++; }
        else { if(w) w.textContent="Tie"; }
      } else { if(w) w.textContent="-"; }
    }

    // Player totals (strokes/putts)
    var puttsTotals=[];
    state.players.forEach(function(p){ var sc=state.scores[p.name],out=0,inn=0,tot=0,pt=0;
      for(var h=0;h<18;h++){ var v=parseFloat(sc.strokes[h]); if(!isNaN(v)){ if(h<9) out+=v; else inn+=v; tot+=v; } var pv=parseFloat(sc.putts[h]); if(!isNaN(pv)) pt+=pv; }
      var oc=document.querySelector('[data-out-for="'+p.name+'"]'); if(oc) oc.textContent=out||"";
      var ic=document.querySelector('[data-in-for="'+p.name+'"]'); if(ic) ic.textContent=inn||"";
      var tc=document.querySelector('[data-tot-for="'+p.name+'"]'); if(tc) tc.textContent=tot||"";
      var pc=document.querySelector('[data-putts-for="'+p.name+'"]'); if(pc) pc.textContent=pt||"";
      puttsTotals.push({name:p.name,putts:pt});
    });

    // Segment bonuses ($) + set S1/S2/S3 per player
    var bonuses={}; state.players.forEach(function(p){bonuses[p.name]=0;});
    for(var s=0;s<3;s++){
      var winTeam = null;
      if(segmentTeamWins[s].A>segmentTeamWins[s].B) winTeam="A";
      else if(segmentTeamWins[s].B>segmentTeamWins[s].A) winTeam="B";
      state.players.forEach(function(p){
        var cell=document.querySelector('[data-pseg-for="'+p.name+'"][data-seg="'+s+'"]');
        if(cell){ cell.textContent = (winTeam && p.teams[s]===winTeam) ? "1" : "0"; }
      });
      if(winTeam){
        state.players.forEach(function(p){ if(p.teams[s]===winTeam) bonuses[p.name]+=state.segmentBonus; });
      }
    }

    // Putts pot ($)
    var pot=state.players.length*state.puttFee;
    var valid=puttsTotals.filter(function(x){return !isNaN(x.putts) && x.putts>0;});
    var min=null; valid.forEach(function(x){ if(min===null||x.putts<min) min=x.putts; });
    var winners=valid.filter(function(x){ return x.putts===min; }); var share=(winners.length? pot/winners.length : 0);
    var earn={}; state.players.forEach(function(p){earn[p.name]=-state.puttFee;});
    winners.forEach(function(w){earn[w.name]+=share;});
    Object.keys(bonuses).forEach(function(n){earn[n]+=bonuses[n];});

    // ---- Greenies points + dots ----
    var greenPts={}; state.players.forEach(function(p){greenPts[p.name]=0;});
    var p3 = state.par3.slice().sort(function(a,b){return a-b;});
    var carryCount=0;
    for(var i=0;i<p3.length;i++){
      var h1 = p3[i], idx=h1-1, wname = state.greenieWinner[idx];
      var mult = 1 + carryCount; // dots shown this hole
      var gcell = document.getElementById("green_"+idx);
      if(gcell) gcell.textContent = dotText(mult);
      if(wname && wname!=="CARRY"){
        greenPts[wname] += mult;
        carryCount = 0;
      } else {
        carryCount += 1;
      }
    }

    // Render earnings ($) and greenies points
    state.players.forEach(function(p){
      var earnCell=document.querySelector('[data-earn-for="'+p.name+'"]');
      if(earnCell) earnCell.textContent=earn[p.name].toFixed(2);
      var gpCell=document.querySelector('[data-gp-for="'+p.name+'"]');
      if(gpCell) gpCell.textContent=greenPts[p.name];
    });

    // Sidebar summary
    var lines=[]; lines.push("Pot: $"+pot.toFixed(2)+" ("+state.players.length+" × $1)");
    if(winners.length){ lines.push("Lowest total putts: "+winners.map(function(w){return w.name+" ("+w.putts+")";}).join(", ")); lines.push("Payout: $"+share.toFixed(2)+" each"); }
    else lines.push("Lowest total putts: —");
    ["S1 (1–6)","S2 (7–12)","S3 (13–18)"].forEach(function(lbl,idx){
      var t = segmentTeamWins[idx].A>segmentTeamWins[idx].B?"A":(segmentTeamWins[idx].B>segmentTeamWins[idx].A?"B":"Tie");
      lines.push(lbl+": "+(t==="Tie"?"Tie (no bonus)":"Team "+t+" (+$0.25 to players)"));
    });
    var gl="Greenies points: ", parts=[];
    state.players.forEach(function(p){ parts.push(p.name+" "+(document.querySelector('[data-gp-for=\"'+p.name+'\"]').textContent||"0")); });
    lines.push(gl+parts.join(", "));
    $("moneySummary").innerHTML=lines.join("<br>");
  }

  function hookSidebar(){
    $("players").addEventListener("input", function(e){
      if(e.target.className==="pname"){
        var i=+e.target.dataset.i,old=state.players[i].name,nv=e.target.value;
        state.players[i].name=nv; ensure(nv);
        if(old!==nv && state.scores[old]){ state.scores[nv]=state.scores[old]; delete state.scores[old]; }
        renderTable(); hookTable(); recompute();
      }
      if(e.target.className==="pteam"){
        var i=+e.target.dataset.i, sg=+e.target.dataset.s;
        state.players[i].teams[sg]=e.target.value; recompute();
      }
    });
    $("players").addEventListener("click", function(e){
      if(e.target.dataset.del){ var i=+e.target.dataset.del, nm=state.players[i].name;
        state.players.splice(i,1); delete state.scores[nm];
        renderSidebar(); renderTable(); hookTable(); recompute();
      }
    });
    document.getElementById("addP").addEventListener("click", function(){
      var i=state.players.length; state.players.push({name:"Player "+(i+1),teams:["A","B","A"]});
      renderSidebar(); renderTable(); hookTable(); recompute();
    });
    document.getElementById("clearP").addEventListener("click", function(){
      state.players.forEach(function(p){ state.scores[p.name] = {strokes:Array(18).fill(""), putts:Array(18).fill("")}; });
      state.greenieWinner = Array(18).fill("");
      renderTable(); hookTable(); recompute();
      var first=document.querySelector('input[data-r="0"][data-c="0"]'); if(first) first.focus();
    });
    document.getElementById("method").addEventListener("change", function(){ state.method=this.value; recompute(); });
    document.getElementById("eventName").addEventListener("input", function(){ document.getElementById("titleOut").textContent=this.value; });
    document.getElementById("par3Input").addEventListener("input", function(){
      var raw=this.value.split(",").map(function(x){return parseInt(x.trim(),10)}).filter(function(n){return !isNaN(n)&&n>=1&&n<=18;});
      state.par3 = raw.length? raw : [];
      renderTable(); hookTable(); recompute();
    });
  }

  function hookTable(){
    var tbody=document.getElementById("tbody");
    tbody.addEventListener("focusin", function(e){ if(e.target.tagName==="INPUT"){ if(pending) clearTimeout(pending); e.target.select(); } });
    tbody.addEventListener("keydown", function(e){
      var t=e.target; if(t.tagName!=="INPUT") return; var r=+t.dataset.r, c=+t.dataset.c;
      if(pending){clearTimeout(pending); pending=null;}
      if(e.key==="Enter"||e.key==="ArrowDown"||(e.key==="Tab"&&!e.shiftKey)){ e.preventDefault(); moveDown(r,c); }
      else if(e.key==="ArrowUp"||(e.key==="Tab"&&e.shiftKey)){ e.preventDefault(); moveUp(r,c); }
    });
    tbody.addEventListener("input", function(e){
      var t=e.target; if(t.tagName!=="INPUT") return; var nm=t.dataset.n, k=t.dataset.k, h=+t.dataset.h;
      if(k==="strokes"){ t.value=t.value.replace(/\D/g,'').slice(0,2); }
      else{ t.value=t.value.replace(/\D/g,'').slice(0,1); }
      state.scores[nm][k][h]=t.value;
      if(pending) clearTimeout(pending);
      var delay=(k==="strokes")?260:100;
      pending=setTimeout(function(){
        var v=(t.value||"").trim();
        if(k==="strokes"){
          if(v==="") return;
          if(v.length===2){ if(parseInt(v,10)>10){ v="10"; t.value=v; state.scores[nm][k][h]=v; } moveDown(+t.dataset.r,+t.dataset.c); }
          else{ if(v!=="1"){ moveDown(+t.dataset.r,+t.dataset.c); } }
        } else {
          if(v!==""){ moveDown(+t.dataset.r,+t.dataset.c); }
        }
        pending=null;
      }, delay);
      recompute();
    });

    // Winner dropdowns
    tbody.addEventListener("change", function(e){
      var t=e.target;
      if(!(t.tagName==="SELECT" && t.classList.contains("greenie"))) return;
      var h1 = parseInt(t.dataset.h1,10), idx=h1-1;
      state.greenieWinner[idx] = t.value || "";
      renderTable();
      hookTable();
      recompute();
    });
  }

  function init(){
    renderSidebar(); renderTable(); hookSidebar(); hookTable(); recompute();
    var first=document.querySelector('input[data-r="0"][data-c="0"]'); if(first) first.focus();
  }
  init();
})();
</script>
</body>
</html>
